<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>bmp图像格式</title>

  	<link rel="stylesheet" href="templates/SyntaxHighlighter.css"></link>
	<link rel="stylesheet" href="templates/style.css">
	
	<script	src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script language="javascript" src="templates/shCore.js"></script>
	<script language="javascript" src="templates/shBrushCpp.js"></script>
	<script language="javascript" src="templates/shBrushJScript.js"></script>
	<script language="javascript" src="templates/shBrushPhp.js"></script>
	<script language="javascript" src="templates/shBrushJava.js"></script>
	<script language="javascript" src="templates/shBrushXml.js"></script>
	<script language="javascript" src="templates/shBrushCss.js"></script>
	
	<script language="javascript" src="templates/vimwiki.js"></script>
</head>


<body>
    <div class="navbar">
      <div class="navbar-container">
	  <a class="brand" href="index.html">NieNet</a>
	  <div class="nav-collapse">
		<ul class="nav">
		  <li><a href="index.html">主页</a></li>
		  <li><a href="about.html">关于</a></li>
		</ul>
	  </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
	<div id="content">
	
<h2 id="toc_0.1">简介</h2>
<p>
BMP(Bitmap-File)图形文件是Windows采用的图形文件格式，在Windows环境下运行的所有图象处理软件都支持BMP图象文件格式。Windows系统内部各图像绘制操作都是以BMP为基础的。Windows 3.0以前的BMP图文件格式与显示设备有关，因此把这种BMP图象文件格式称为设备相关位图DDB(device-dependent bitmap)文件格式。Windows 3.0以后的BMP图象文件与显示设备无关，因此把这种BMP图象文件格式称为设备无关位图DIB(device-independent bitmap)格式（注：Windows 3.0以后，在系统中仍然存在DDB位图，象BitBlt()这种函数就是基于DDB位图的，只不过如果你想将图像以BMP格式保存到磁盘文件中时，微软 极力推荐你以DIB格式保存），目的是为了让Windows能够在任何类型的显示设备上显示所存储的图象。BMP位图文件默认的文件扩展名是BMP或者 bmp（有时它也会以.DIB或.RLE作扩展名）。
</p>

<p>
BMP是bitmap的缩写形式，bitmap顾名思义，就是位图也即Windows位图。它一般由4部分组成：文件头信息块、图像描述信息块、颜色表（在真彩色模式无颜色表）和图像数据区组成。在系统中以BMP为扩展名保存。   
</p>

<p>
打开Windows的画图程序，在保存图像时，可以看到三个选项：2色位图（黑白）、16色位图、256色位图和24位位图。这是最普通的生成位图的工具，在这里讲解的BMP位图形式，主要就是指用画图生成的位图（当然，也可以用其它工具软件生成）。
</p>



<h2 id="toc_0.2">文件结构</h2>
<p>
位图文件可看成由4个部分组成：位图文件头(bitmap-file header)、位图信息头(bitmap-information header)、彩色表(color table)和定义位图的字节阵列，它具有如下所示的形式。
</p>


<h3 id="toc_0.2.1">1.文件头信息块</h3>
<ul>
<li>
0000-0001：文件标识，为字母ASCII码“BM”。   

<li>
0002-0005：文件大小。   

<li>
0006-0009：保留，每字节以“00”填写。   

<li>
000A-000D：记录图像数据区的起始位置

</ul>

<h3 id="toc_0.2.2">2.图像描述信息块</h3>
    
<ul>
<li>
000E-0011：图像描述信息块的大小，常为28H。   

<li>
0012-0015：图像宽度。   

<li>
0016-0019：图像高度。   

<li>
001A-001B：图像的plane(平面)总数（恒为1）。   

</ul>

<ul>
<li>
001C-001D：记录像素的位数，很重要的数值，图像的颜色数由该值决定。   

<li>
001E-0021：数据压缩方式（数值位0：不压缩；1：8位压缩；2：4位压缩）。   

<li>
0022-0025：图像区数据的大小。   

<li>
0026-0029：水平每米有多少像素，在设备无关位图（.DIB）中，每字节以00H填写。   

<li>
002A-002D：垂直每米有多少像素，在设备无关位图（.DIB）中，每字节以00H填写。   

<li>
002E-0031：此图像所用的颜色数，如值为0，表示所有颜色一样重要。

</ul>


<h3 id="toc_0.2.3">3.颜色表</h3>
<p>
颜色表的大小根据所使用的颜色模式而定：2色图像为8字节；16色图像位64字节；256色图像为1024字节。其中，每4字节表示一种颜色，并以B（蓝色）、G（绿色）、R（红色）、alpha（像素的透明度值，一般不需要）。即首先4字节表示颜色号0的颜色，接下来表示颜色号1的颜色，依此类推。   
</p>
    
<h3 id="toc_0.2.4">4.图像数据区</h3>
<p>
颜色表接下来位为位图文件的图像数据区，在此部分记录着每点像素对应的颜色号，其记录方式也随颜色模式而定，既2色图像每点占1位（8位为1字节）；16色图像每点占4位（半字节）；256色图像每点占8位（1字节）；真彩色图像每点占24位（3字节）。所以，整个数据区的大小也会随之变化。究其规律而言，可的出如下计算公式：图像数据信息大小=（图像宽度*图像高度*记录像素的位数）/8。   
</p>
    
<p>
然而，未压缩的图像信息区的大小。除了真彩色模式外，其余的均大于或等于数据信息的大小。这是为什么呢？原因有两个：   
</p>
<ul>
<li>
1.BMP文件记录一行图像是以字节为单位的。因此，就不存在一个字节中的数据位信息表示的点在不同的两行中。也就是说，设显示模式位16色，在每个字节分配两个点信息时，如果图像的宽度位奇数，那么最后一个像素点的信息将独占一个字节，这个字节的后4位将没有意义。接下来的一个字节将开始记录下一行的信息。   

<li>
2.为了显示的方便，除了真彩色外，其他的每中颜色模式的行字节数要用数据“00”补齐为4的整数倍。如果显示模式为16色，当图像宽为19时，存储时每行则要补充4-(19/2+1)%4=2个字节（加1是因为里面有一个像素点要独占了一字节）。如果显示模式为256色，当图像宽为19时，每行也要补充4-19%4=1个字节。 

</ul>

	</div>
    </div>

    <footer>
	<p id="legal">Copyright &copy; 2012 NIE-YONG. All Rights Reserved.</p>
    </footer>

    <a class="go2top" style="display: none;"><span></span></a>

</body>


<script language="javascript">
dp.SyntaxHighlighter.HighlightAll('code');
</script>

</html>


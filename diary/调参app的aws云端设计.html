<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>调参app的aws云端设计</title>

  	<link rel="stylesheet" href="templates/SyntaxHighlighter.css"></link>
	<link rel="stylesheet" href="templates/style.css">
	
	<script	src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script language="javascript" src="templates/shCore.js"></script>
	<script language="javascript" src="templates/shBrushCpp.js"></script>
	<script language="javascript" src="templates/shBrushJScript.js"></script>
	<script language="javascript" src="templates/shBrushPhp.js"></script>
	<script language="javascript" src="templates/shBrushJava.js"></script>
	<script language="javascript" src="templates/shBrushXml.js"></script>
	<script language="javascript" src="templates/shBrushCss.js"></script>
	<script language="javascript" src="templates/shBrushObjectiveC.js"></script>
	
	<script language="javascript" src="templates/vimwiki.js"></script>
</head>


<body>
    <div class="navbar">
      <div class="navbar-container">
	  <a class="brand" href="index.html">NieNet</a>
	  <div class="nav-collapse">
		<ul class="nav">
		  <li><a href="index.html">主页</a></li>
		  <li><a href="about.html">关于</a></li>
		</ul>
	  </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
	<div id="content">
	
<p>
调参app需要同步用户的配置文件和设备信息到云端，以此达到用户信息不会丢失，不同设备之间无缝切换的效果。
</p>

<p>
用户配置文件是指用户导出的主控配置信息。操作的唯一路径：More -&gt; Import-Export Parameters -&gt; 右上角加号按钮导出信息；
</p>

<p>
用户的设备信息是指用户成功连接过的所有主控信息。只要用户成功连接过某一主控，该主控的hardwareID，用户名，密码，主控类型就会被保存。
</p>

<p>
用户可以备份（添加），查看，删除，导入配置信息；
</p>

<p>
用户可以查看和修改设备信息，包括用户名和密码。hardwareID和主控类型不能够被修改和查看。只能够修改当前被连接的主控用户名和密码。如果保存的主控信息和将要连接的主控信息匹配，则直接连接，无需输入用户名和密码。
</p>

<h2 id="toc_0.1">云端服务器设计</h2>
<p>
使用Amazon的web服务S3作为云端，每个用户保存两个文件，分别位于路径Buckets/www.assistant.com/config和Buckets/www.assistant.com/device路径下，文件名为该用户注册的邮箱。
</p>

<p>
例如某用户注册了用户名test@126.com，那么他的配置文件就会保存在文件Buckets/www.assistant.com/config/test@126.com中，设备信息就会被保存在文件Buckets/www.assistant.com/device/test@126.com中。
</p>

<p>
在调参app中，用户的配置文件保存在./document/Config.plist文件中，设备文件保存在./document/Device.plist文件中。这和S3云端的两个文件是一样的，只是文件名不同而已；
</p>

<p>
下面分别介绍Config.plist文件和Device.plist文件的结构。
</p>

<h2 id="toc_0.2">Config.plist文件结构</h2>
<p>
Config.plist文件是一个plist文件，是将一个NSDictionary字典对象的序列化。字典对象的结构如下所示：
</p>
<pre>
&lt;dict&gt;
	&lt;key&gt;userName&lt;/key&gt;			//该配置文件的用户名
	&lt;string&gt;test@126.com&lt;/string&gt;
	
	//配置条目1
	&lt;key&gt;2013-01-04-11-58-14&lt;/key&gt;		//该配置条目的创建时间，作为条目的key
	&lt;dict&gt;
		&lt;key&gt;headInfo&lt;/key&gt;		//头信息
		&lt;dict&gt;
			&lt;key&gt;configName&lt;/key&gt;	//该配置条目的名称
			&lt;key&gt;mcType&lt;/key&gt;	//该配置条目所属的主控类型
			&lt;key&gt;time&lt;/key&gt;		//创建时间
		&lt;/dict&gt;
		&lt;key&gt;paramInfo&lt;/key&gt;		//配置参数
		&lt;dict&gt;
			......			//具体的配置参数
		&lt;/dict&gt;
	&lt;/dict&gt;
	
	//配置条目2
	......
	
	//配置条目3
	......
&lt;/dict&gt;
</pre>

<h2 id="toc_0.3">Device.plist文件结构</h2>
<p>
Device.plist文件也是一个plist文件，是将一个NSDictionary字典对象的序列化。字典对象的结构如下所示：
</p>
<pre>
&lt;dict&gt;
	&lt;key&gt;userName&lt;/key&gt;			//该配置文件的用户名
	&lt;string&gt;test@126.com&lt;/string&gt;
	
	//设备条目1
	&lt;key&gt;D2501200&lt;/key&gt;			//该条设备信息所属的主控hardwareID，唯一，作为key
	&lt;dict&gt;
		&lt;key&gt;deviceName&lt;/key&gt;		//主控名字
		&lt;key&gt;mcType&lt;/key&gt;		//主控类型
		&lt;key&gt;password&lt;/key&gt;		//主控密码
	&lt;/dict&gt;
	
	//设备条目2
	&lt;key&gt;F2705540&lt;/key&gt;
	&lt;dict&gt;
		&lt;key&gt;deviceName&lt;/key&gt;
		&lt;string&gt;Chen&lt;/string&gt;
		&lt;key&gt;mcType&lt;/key&gt;
		&lt;string&gt;wookong-M&lt;/string&gt;
		&lt;key&gt;password&lt;/key&gt;
		&lt;string&gt;abcdef&lt;/string&gt;
	&lt;/dict&gt;
	
	//设备条目3
	&lt;key&gt;F2710820&lt;/key&gt;
	&lt;dict&gt;
		&lt;key&gt;deviceName&lt;/key&gt;
		&lt;string&gt;Chen&lt;/string&gt;
		&lt;key&gt;mcType&lt;/key&gt;
		&lt;string&gt;wookong-M&lt;/string&gt;
		&lt;key&gt;password&lt;/key&gt;
		&lt;string&gt;123456&lt;/string&gt;
	&lt;/dict&gt;
&lt;/dict&gt;
</pre>

<h2 id="toc_0.4">云端同步的基本流程</h2>
<p>
数据的同步等需要考虑几个因素，包括当前app的帐户，网络是否连接。下面简单介绍如下：
</p>

<p>
当前用户有两种状态：
</p>
<ul>
<li>
存在用户状态（可能已经登陆，或者没有登陆成功，但是是上一次登陆的帐户，简称default状态）

<li>
没有用户状态，简称nobody状态

</ul>
<blockquote>
注意：如果用户注册过帐号，就不可能再变为nobody状态，只可能是切换其他用户，或者登出，登出也只是用户从登陆状态变为了default状态。
</blockquote>

<p>
在app启动或者用户切换成功之后（切换用户不包括登出操作，登出只是用户从登陆状态变为了default状态），但会进行以此初始化，包括一下几个步骤：
</p>

<ul>
<li>
下载云端文件到本地（只有这个条件会下载云端文件到本地）

<li>
合并信息（原来为nobody状态的内容合并到当前登陆的帐户）

<li>
上传文件到云端

</ul>

<p>
除此之外，下面几个条件下还会上传数据到云端：
</p>
<ul>
<li>
添加／删除了配置条目

<li>
连接了新的主控，或者主控信息被修改

</ul>

	</div>
    </div>

    <footer>
	<p id="legal">Copyright &copy; 2012 NIE-YONG. All Rights Reserved.</p>
    </footer>

    <a class="go2top" style="display: none;"><span></span></a>

</body>


<script language="javascript">
dp.SyntaxHighlighter.HighlightAll('code');
</script>

</html>


<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>git使用笔记</title>

  	<link rel="stylesheet" href="templates/SyntaxHighlighter.css"></link>
	<link rel="stylesheet" href="templates/style.css">
	
	<script	src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script language="javascript" src="templates/shCore.js"></script>
	<script language="javascript" src="templates/shBrushCpp.js"></script>
	<script language="javascript" src="templates/shBrushJScript.js"></script>
	<script language="javascript" src="templates/shBrushPhp.js"></script>
	<script language="javascript" src="templates/shBrushJava.js"></script>
	<script language="javascript" src="templates/shBrushXml.js"></script>
	<script language="javascript" src="templates/shBrushCss.js"></script>
	<script language="javascript" src="templates/shBrushObjectiveC.js"></script>
	
	<script language="javascript" src="templates/vimwiki.js"></script>
</head>


<body>
    <div class="navbar">
      <div class="navbar-container">
	  <a class="brand" href="index.html">NieNet</a>
	  <div class="nav-collapse">
		<ul class="nav">
		  <li><a href="index.html">主页</a></li>
		  <li><a href="about.html">关于</a></li>
		</ul>
	  </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
	<div id="content">
	
<p>
更多详细使用，参考<a href="wiki_ny/git.html">Nie Yong Note's Git</a>。
</p>

<ul>
<li>
<a href="wiki_ny/git基本配置记录.html">wiki_ny/git基本配置记录</a>

<li>
<a href="wiki_ny/git基本概念记录.html">wiki_ny/git基本概念记录</a>

</ul>

<h2 id="toc_0.1">删除某一次提交</h2>
<p>
   git reset HEAD^ 	//回退第一个记录 
   git reset HEAD~2 	//回退第二个记录 
   git reset --hard HEAD~2 	//回退第二个记录，工作目录下的文件也回退
</p>

<p>
使用<code>git reset</code>或者<code>git revert</code>命令。注意两点：
</p>
<ol>
<li>
<code>git reset</code>和<code>git revert</code>的区别，<code>git reset</code>是直接删除提交记录进行回溯，在graph上可以看到，被回溯的那几个提交记录已经不再任何分支的控制范围内。在这种情况下，默认情况下，是无法看到这几次提交的记录的。而<code>git revert</code>是使用一次相反的提交覆盖上次提交；

<li>
<code>git reset</code>命令有3个重要的参数，分别是--mixed（默认）、--soft、--hard：

<ul>
<li>
其中--hard选项会造成修改内容不可恢复的后果，原因是该选项会将当前HEAD所指的内容覆盖掉缓存区域和工作空间中的内容；

<li>
--mixed选项则只会用HEAD所指内容将缓存区域的内容覆盖，这就是为什么使用命令<code>git reset</code>能够将已经缓存的内容清除掉，--mixed为reset的默认选项。

<li>
选项--soft则只会将HEAD移动，并不会将现在HEAD所指的内容覆盖缓存空间和工作空间。如果使用reset命令之后工作空间并未用HEAD所指的内容覆盖（--soft、--mixed选项），就会存在工作空间处于修改状态，需要提交。

</ul>
</ol>

<h2 id="toc_0.2">清除已经缓存的（staged）文件</h2>
<blockquote>
git reset filename		//相当于git reset --mixed HEAD filename
</blockquote>
<p>
修改了两个文件，然后使用命令<code>git add .</code>将这两个文件的修改都提交为缓存，也就是出于staged状态。这时，如果你想撤销掉某个文件的staged状态，使用命令<code>git reset filename</code>，其实这条命令的完整表达应该是<code>git reset --mixed HEAD filename</code>。
</p>

<p>
参见《progit》的p28。
</p>

<h2 id="toc_0.3">tag记录发布版本</h2>
<ul>
<li>
git tag -a v1.0 -m 'my version 1.0'

</ul>
<p>
创建一个tag
</p>

<ul>
<li>
git push origin --tags 

</ul>
<p>
要将在本地创建的tag提交到github上
</p>

<h2 id="toc_0.4">多份代码拷贝的合并</h2>
<ul>
<li>
git pull ../mbooke_usb/

</ul>
<p>
区别于一份代码中有多个分支的合并，这里的应用场景描述如下：
</p>

<p>
有一份代码， <strong>使用了git做版本控制</strong>  。然后这份代码被拷贝了两份，然后在每一份上分别有多次提交。最后，需要把两份代码上做的修改合并到同一份代码上。
</p>

<p>
一般用于没有server端的多人协作开发，一份代码用U盘拷贝给多人开发。
</p>

<p>
使用命令git pull可以达到目的。
</p>

<h2 id="toc_0.5">git分支与合并</h2>
<p>
git分支与合并主要阅读了《pro git》一书的分支一章，强烈建议。
</p>

<p>
查看现在所有分支，分支前带有*号，表示现在所在分支
</p>
<ul>
<li>
#git branch

</ul>

<p>
创建一个新的分支
</p>
<ul>
<li>
#git branch hotfix	//hotfix为新创建分支名

</ul>

<p>
切换到另外一个分支
</p>
<ul>
<li>
#git checkout hotfix	//hotfix为已经创建的分支

</ul>

<p>
创建一个新的分支并且同时切换到该分支
</p>
<ul>
<li>
#git checkout -b 'hotfix' //hotfix为新创建分支名

</ul>

<p>
删除一个分支
</p>
<ul>
<li>
#git branch -d hotfix	//删除hotfix分支

</ul>

<p>
合并某一个分支到本身所在的分支
</p>
<ul>
<li>
#git merge hotfix	 //合并hotfix分支的修改到本身所在的分支

<li>
#git merge --no-ff hotfix	//使用非fastfoward的方式合并分支

</ul>

<h2 id="toc_0.6">git使用小技巧</h2>
<p>
将修改添加到版本库中，使用git add .命令，而不要使用git add *命令。因为*代表所有的文件，那么别.gitignore文件忽略的文件（或者文件夹）也会被添加。
</p>

<p>
使用git log时要实现自动换行，不要长行截断模式，可以设置LESS环境变量（分页器）：
</p>
<blockquote>
#export LESS=FRX
</blockquote>
<p>
或者，你可以配置git的分页器（pager）配置文件为-FRX。如果你想使用原来的长行截断模式，那么就使用-FRSX选项。
</p>
<blockquote>
#git config --global core.pager 'less -+$LESS -FRX'
</blockquote>

<p>
中文无法显示，使用8进制字符编码来显示的问题：
</p>
<blockquote>
#git config --global core.quotepath false
</blockquote>


<h2 id="toc_0.7">git diff的用法</h2>
<p>
查看文件的修改情况，使用命令 git diff src。
</p>

<p>
git diff命令没有选项，不会去比较已经位于暂存区（staged）的文件和上次提交的文件的区别。所以，查看使用命令git add加载到暂存区的文件（staged）所做的修改，使用命令：
</p>
<blockquote>
git diff --cached
</blockquote>

<h2 id="toc_0.8">detached HEAD</h2>
<p>
使用下面的命令，会出现该情况：
</p>
<blockquote>
git checkout master~2
</blockquote>

<h2 id="toc_0.9">git ignore</h2>
<p>
The idea is to keep locally your ".DS_Store", while removing them from the git repo.
</p>

<p>
The .gitignore will work only if those ".DS_Store" are first removed from the index, hence the "git rm --cached -f" (see git rm).
</p>
<pre>
find . -name ".DS_Store" -exec git rm --cached -f {} \;.
git commit -m "delete files"
git push
</pre>

<p>
下面这两种写法的区别：
<strong>.xcodeproj/</strong>
<strong>.xcodeproj/</strong>
</p>


<h2 id="toc_0.10">git log的用法</h2>
<p>
以适当的形式显示整个工程，或者多个文件，整个目录等的log信息。
</p>
<pre>
[ny@localhost android-xbmcremote]$ git log --pretty=format:"%h - %ar : %s"
3dc5868 - 3 months ago : New release: v0.8.7 beta1
3dc5868 - 3 months ago : New release: v0.8.7 beta1
aebb506 - 4 months ago : Changed: Set network location as non-required for better tablet3dc5868 - 3 months ago : New release: v0.8.7 beta1

[ny@localhost android-xbmcremote]$ git log --date=short --pretty=format:"%h - %ad : %s"
3dc5868 - 2011-08-28 : New release: v0.8.7 beta1
aebb506 - 2011-08-14 : Changed: Set network location as non-required for better tablet support.
ced6d79 - 2011-08-14 : Changed: New icon for text entry

[ny@localhost android-xbmcremote]$ git log --date=short --pretty=format:"%ad : %s" --stat ./src/  ./res/layout/
</pre>

<p>
详细的显示某次提交的log信息。
</p>


<h2 id="toc_0.11">github mac gui的sync操作</h2>
<p>
两人合作开发，从某个共同的节点开始，A做了几次提交，并且上传github。B也做了几次提交，在本地。然后B使用github的mac端gui做一个syn（同步到github）。如果A和B的修改没有冲突，那么B的提交就会rebase到A的提交上，并且上传github成功，这样看上去就是一个线性的提交纪录。如果B的修改和A有冲突，那么有冲突的提交版本就会rebase失败。
</p>

<p>
此时，可以查看到git的状态如下。
</p>

<pre>
nieyong@mac:~/github/DJIAssistantForIphone &gt; git st
# Not currently on any branch.
# You are currently rebasing.
#   (fix conflicts and then run "git rebase --continue")
#   (use "git rebase --skip" to skip this patch)
#   (use "git rebase --abort" to check out the original branch)
#
# Changes to be committed:
#   (use "git reset HEAD &lt;file&gt;..." to unstage)
#
#	modified:   AssistantForIphone/AssistantForIphone/ASSMore/ASSMore.m
#	modified:   AssistantForIphone/AssistantForIphone/ASSMore/subView/AccountsViewController.h
#	modified:   AssistantForIphone/AssistantForIphone/ASSMore/subView/AccountsViewController.m
#	new file:   AssistantForIphone/AssistantForIphone/ASSMore/subView/FeedbackViewController.h
#	new file:   AssistantForIphone/AssistantForIphone/ASSMore/subView/FeedbackViewController.m
#	new file:   AssistantForIphone/AssistantForIphone/ASSMore/subView/ImportExportParametersViewController.h
#	new file:   AssistantForIphone/AssistantForIphone/ASSMore/subView/ImportExportParametersViewController.m
#	modified:   AssistantForIphone/AssistantForIphone/ASSMore/subView/UserRegisterController.h
#	modified:   AssistantForIphone/AssistantForIphone/ASSMore/subView/UserRegisterController.m
#
# Unmerged paths:
#   (use "git reset HEAD &lt;file&gt;..." to unstage)
#   (use "git add &lt;file&gt;..." to mark resolution)
#
#	both modified:      AssistantForIphone/AssistantForIphone.xcodeproj/project.pbxproj
</pre>

<p>
此时，我们不想rabase存在，那么就使用<code>git rebase --abort</code>放弃所作的其它rebase。使用该动作之后，就可以看到下面的信息，显示refact分支和origin/refact分支分叉了。
</p>

<pre>
nieyong@mac:~/github/DJIAssistantForIphone &gt; git st
# On branch refact
# Your branch and 'origin/refact' have diverged,
# and have 3 and 2 different commits each, respectively.
#
nothing to commit, working directory clean
</pre>

<p>
此时，使用merge的方式合并A和B做的提交。使用命令<code>git merge origin/refact</code>，然后解决冲突提交就OK。
</p>

<p>
整个过程，只需要明白一点，那就是github的mac gui在sync的时候，默认是做的rebase操作。知晓了这一点，其他的就迎刃而解了。
</p>

<h2 id="toc_0.12">merge 时没有合并到origin分支的警告</h2>
<p>
在开发过程中，出现下面这样的警告
</p>
<pre>
nieyong@mac:~/github/DJIAssistantForIphone &gt; git br -d I18N
warning: not deleting branch 'I18N' that is not yet merged to
         'refs/remotes/origin/I18N', even though it is merged to HEAD.
error: The branch 'I18N' is not fully merged.
If you are sure you want to delete it, run 'git branch -D I18N'.
</pre>

<p>
it knows that I18N is a tracking branch for origin/I18N, so it wants to know that changes done on I18N have been pushed to origin. 
</p>

<p>
git reset --hard # removes staged and working directory changes
</p>

<p>
git clean -f -d # remove untracked files
git clean -f -x -d # CAUTION: as above but removes ignored files like config.
</p>


<h2 id="toc_0.13">git中不可恢复的操作</h2>
<p>
删除工作空间中的某个文件的所有修改，恢复到上一次提交时的状态。
</p>
<ul>
<li>
git checkout -- filename

</ul>

<p>
如果该文件的修改已经使用<code>git add</code>提交为缓存，则不会起作用，这是需要使用<code>git reset HEAD .</code>将文件由缓存空间unstage到工作空间，然后再使用该命令撤销所有的修改。注意，对于删除了的文件，该命令也一样起效。对于新加入的文件，还处于Untrack状态，则不会起作用。
</p>


<p>
恢复到某一次提交之后的状态，删除在这次提交之后到所有提交、修改记录。
</p>
<ul>
<li>
git reset --hard HEAD~2

</ul>

<h2 id="toc_0.14">参考资料</h2>
<ul>
<li>
<a href="http://zhwen.org/?p=articles/git">git使用总结 作者：许振文</a>

<li>
<a href="http://www.worldhello.net/gotgithub/index.html">GotGitHub 作者：蒋鑫</a>

<li>
<a href="http://progit.org/">Pro Git</a>

<li>
<a href="http://gitx.laullon.com/">gitx下载地址</a>

</ul>

	</div>
    </div>

    <footer>
	<p id="legal">Copyright &copy; 2012 NIE-YONG. All Rights Reserved.</p>
    </footer>

    <a class="go2top" style="display: none;"><span></span></a>

</body>


<script language="javascript">
dp.SyntaxHighlighter.HighlightAll('code');
</script>

</html>


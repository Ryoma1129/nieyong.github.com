[[bluetooth essentials for programmers]]

[[TI CC254x develop]]

2.1KB/s的传输速率

音乐差的也要64Kbps啊

jawbone手环就是这么做

== Bluetooth笔记 ==

* Dual-mode bluetooth:Devices that can support BR and BLE are referred to as “dual-mode” devices. Typically in a Bluetooth system, a mobile phone or laptop computer will be a dual-mode device. 
* Single-mode bluetooth:Devices that only support BLE are referred to as “single-mode” devices. These single-mode devices are generally used for application in which low power consumption is a primary concern, such as those that run on coin cell batteries.The CC2540 is a certified single-mode Bluetooth low energy  device. 

可以开发ble应用的手机需要满足的条件。

In order to write an application on a smartphone that can communicate with the CC2540, the smartphone must:
* Contain hardware that supports dual-mode Bluetooth (traditional BT and Bluetooth low energy)
* Have some kind of support in their SDK for using the Bluetooth low energy

== BLE的连接参数 ==
*connection event & connection interval*

Even if there is no application data to be sent or received, the two devices will still exchange link layer data to maintain the connection. The connection interval is the amount of time between two connection events, in units of 1.25ms. The connection interval can range from a minimum value of 6 (7.5ms) to a maximum of 3200 (4.0s).

设备必须在连接事件发生的时候，才能够收发数据。

*Slave Latency*

This parameter gives the slave (peripheral) device the option of skipping a number of connection events.跳过连接事件的前提是自己没有数据要发送，所以该参数只会影响对方发送数据给自己的时间，例如设置slave latency为5，而它自己又正好没有数据要发送出去，结果它就要等5个connection interval才应答一次对方，接收对方发来的数据。

*Supervision Timeout*

This is the maximum amount of time between two successful connection events. 

== Apple的蓝牙外设连接参数要求 ==
Interval Max * (Slave Latency + 1) ≤ 2 seconds
Interval Min ≥ 20 ms
Interval Min + 20 ms ≤ Interval Max 
Slave Latency ≤ 4
connSupervisionTimeout ≤ 6 seconds
Interval Max * (Slave Latency + 1) * 3 < connSupervisionTimeout

=== dji对ble的配置参数 ===
看了上次你给我的ble固件源代码，其中ble的一些参数配置为：
Interval Max为16（20ms）
Interval Min为8（10ms）
Slave Latency为0
connSupervisionTimeout为10（100ms）

== GATT server ==
A GATT server consists of one or more GATT services, which are collections of data to accomplish a particular function or feature.

The characteristic values, along with their properties and their configuration data (known as “descriptors”) on the GATT Server are stored in the attribute table. The attribute table is simply a database containing small pieces of data called attributes. In addition to the value itself, each attribute has the following properties associated with it:

There are a few special attribute types that are found in the GATT attribute table, with values defined by the Bluetooth SIG:（由蓝牙技术联盟规定的一些attribute）

* GATT_PRIMARY_SERVICE_UUID – This indicates the start of a new service, and the type of the service provided
* GATT_CHARACTER_UUID – This is known as the “characteristic declaration”, and it indicates that the attribute immediately following it is a GATT characteristic value
* GATT_CLIENT_CHAR_CFG_UUID – This attribute represents a characteristic descriptor that corresponds to the nearest preceding (by handle) characteristic value in the attribute table. It allows the GATT client to enable notifications of the characteristic value
* GATT_CHAR_USER_DESC_UUID – This attribute represents a characteristic descriptor that corresponds to the nearest preceding (by handle) characteristic value in the attribute table. It contains an ASCII string with a description of the corresponding characteristic

== 固定／可变连接时间间隔 ==
标准蓝牙技术是一种“面向连接”的无线技术,具有固定的连接时间间隔。相反,蓝牙低能耗技术采用可变连接时间间隔,这个间隔根据具体应用可以设置为几毫秒到几秒不等。

== 快速的连接方式 ==
另外,因为BLE技术采用非常快速的连接方式,因此平时可以 处于“非连接”状态(节省能源),此时链路两端相互间只是知晓对方,只有在必要时才开启链路,然后 在尽可能短的时间内关闭链路。

== ble的三大ULP特征 ==
蓝牙低能耗技术的三大特性成就了ULP性能,这三大特性分别是：
* 最大化的待机时间
* 快速连接
* 低峰值的发送/接收功耗。

== ble最小化无线开启时间的技巧 ==
=== 使用3个广告信道 ===
蓝牙低能耗技术最小化无线开启时间的第一个技巧是仅用3个“广告”信道搜索其它设备,或向寻求建立连接的设备宣告自身存在。相比之下,标准蓝牙技术使用了32个信道。这意味着蓝牙低能耗技术扫描其它设备只需“开启”0.6至1.2ms时间,而标准蓝牙技术需要22.5ms时间来扫描它的32个信道。

=== 使用37个数据信道 ===
连接成功后,蓝牙低能耗技术就会切换到37个数据信道之一。在短暂的数据传送期间,无线信号将使用标准蓝牙技术倡导的自适应跳频(AFH)技术以伪随机的方式在信道间切换，标准蓝牙技术使用79个数据信道。

=== 使用更大的原始数据带宽 ===
蓝牙低能耗技术无线开启时间最短的另一个原因是它具有1Mbps的原始数据带宽，更大的带宽允许在更短的时间内发送更多的信息。

蓝牙低能耗技术“完成”一次连接(即扫描其它设备、建立链路、发送数据、认证和适当地结束)只需3ms。

== ble限制峰值功耗 ==
=== 采用更加“宽松的”射频参数 ===
两种技术都使用高斯频移键控(GFSK)调制,但蓝牙低能耗技术使用的调制指数是0.5,而标准蓝牙技术是0.35。0.5的指数接近高斯最小频移键控(GMSK)方案,可以降低无线设备的功耗要求。

=== 发送很短的数据包 ===
发送较长的数据包->无线设备在相对较高的功耗状态保持更长的时间->硅片发热->改变材料的物理特性->改变传送频率(中断链路)->频繁地对无线设备进行再次校准->再次校准将消耗更多的功率(并且要求闭环架构, 使得无线设备更加复杂,从而推高设备价格)。

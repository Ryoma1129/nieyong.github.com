调参app需要同步用户的配置文件和设备信息到云端，以此达到用户信息不会丢失，不同设备之间无缝切换的效果。

用户配置文件是指用户导出的主控配置信息。操作的唯一路径：More -> Import-Export Parameters -> 右上角加号按钮导出信息；

用户的设备信息是指用户成功连接过的所有主控信息。只要用户成功连接过某一主控，该主控的hardwareID，用户名，密码，主控类型就会被保存。

用户可以备份（添加），查看，删除，导入配置信息；

用户可以查看和修改设备信息，包括用户名和密码。hardwareID和主控类型不能够被修改和查看。只能够修改当前被连接的主控用户名和密码。如果保存的主控信息和将要连接的主控信息匹配，则直接连接，无需输入用户名和密码。

== 云端服务器设计 ==
使用Amazon的web服务S3作为云端，每个用户保存两个文件，分别位于路径Buckets/www.assistant.com/config和Buckets/www.assistant.com/device路径下，文件名为该用户注册的邮箱。

例如某用户注册了用户名test@126.com，那么他的配置文件就会保存在文件Buckets/www.assistant.com/config/test@126.com中，设备信息就会被保存在文件Buckets/www.assistant.com/device/test@126.com中。

在调参app中，用户的配置文件保存在./document/Config.plist文件中，设备文件保存在./document/Device.plist文件中。这和S3云端的两个文件是一样的，只是文件名不同而已；

下面分别介绍Config.plist文件和Device.plist文件的结构。

== Config.plist文件结构 ==
Config.plist文件是一个plist文件，是将一个NSDictionary字典对象的序列化。字典对象的结构如下所示：
{{{
<dict>
	<key>userName</key>			//该配置文件的用户名
	<string>test@126.com</string>
	
	//配置条目1
	<key>2013-01-04-11-58-14</key>		//该配置条目的创建时间，作为条目的key
	<dict>
		<key>headInfo</key>		//头信息
		<dict>
			<key>configName</key>	//该配置条目的名称
			<key>mcType</key>	//该配置条目所属的主控类型
			<key>time</key>		//创建时间
		</dict>
		<key>paramInfo</key>		//配置参数
		<dict>
			......			//具体的配置参数
		</dict>
	</dict>
	
	//配置条目2
	......
	
	//配置条目3
	......
</dict>
}}}

== Device.plist文件结构 ==
Device.plist文件也是一个plist文件，是将一个NSDictionary字典对象的序列化。字典对象的结构如下所示：
{{{
<dict>
	<key>userName</key>			//该配置文件的用户名
	<string>test@126.com</string>
	
	//设备条目1
	<key>D2501200</key>			//该条设备信息所属的主控hardwareID，唯一，作为key
	<dict>
		<key>deviceName</key>		//主控名字
		<key>mcType</key>		//主控类型
		<key>password</key>		//主控密码
	</dict>
	
	//设备条目2
	<key>F2705540</key>
	<dict>
		<key>deviceName</key>
		<string>Chen</string>
		<key>mcType</key>
		<string>wookong-M</string>
		<key>password</key>
		<string>abcdef</string>
	</dict>
	
	//设备条目3
	<key>F2710820</key>
	<dict>
		<key>deviceName</key>
		<string>Chen</string>
		<key>mcType</key>
		<string>wookong-M</string>
		<key>password</key>
		<string>123456</string>
	</dict>
</dict>
}}}

== 云端同步的基本流程 ==
数据的同步等需要考虑几个因素，包括当前app的帐户，网络是否连接。下面简单介绍如下：

当前用户有两种状态：
* 存在用户状态（可能已经登陆，或者没有登陆成功，但是是上一次登陆的帐户，简称default状态）
* 没有用户状态，简称nobody状态

    注意：如果用户注册过帐号，就不可能再变为nobody状态，只可能是切换其他用户，或者登出，登出也只是用户从登陆状态变为了default状态。

在app启动或者用户切换成功之后（切换用户不包括登出操作，登出只是用户从登陆状态变为了default状态），但会进行以此初始化，包括一下几个步骤：

* 下载云端文件到本地（只有这个条件会下载云端文件到本地）
* 合并信息（原来为nobody状态的内容合并到当前登陆的帐户）
* 上传文件到云端

除此之外，下面几个条件下还会上传数据到云端：
* 添加／删除了配置条目
* 连接了新的主控，或者主控信息被修改

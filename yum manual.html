<html>
<head>
	<link rel="Stylesheet" type="text/css" href="style.css" />
        <meta http-equiv="Content-Type" content="text/html,charset=utf-8" />
        <title>yum manual</title>
</head>
<body>
	<div id="header"> 
	    <div id="headerlogo">
		<h1><a href="index.html">NieNet 知识库</a></h1>
		<p>Edit by Vimwiki--Powered by Github Pages</p>
	    </div>

	    <div id="headernav">
		<ul id="nav">
		    <li><a href="index.html">首页</a></li>
		    <li><a href="Navigate.html">本站导图</a> </li>
		    <li><a href="AboutMe.html">关于</a> </li>
		    <li><a href="http://nienet.com">返回NieNet</a></li>
		</ul>
	    </div>
	</div> 
        <div id="contents">
<h2 id="toc_0.1">关于源（仓库，repository）</h2>
<p>
仓库(repository)是一个预备好的目录（安装镜像文件iso就可以作为这样一个仓库，下面有如何把安装镜像iso文件作为一个仓库，安装我们在安装系统的时候没有安装的一些工具），或是一个网站，包含了软件包（RPM 软件包）和索引文件。
</p>

<p>
软件管理工具，例如yum，可以在仓库中自动地定位并获取正确的 RPM 软件包。这样，您就不必手动搜索和安装新应用程序和升级补丁了。只用一个命令，您就可以更新系统中所有软件，也可以根据指定搜索目标来查找安装新软件。
</p>

<h2 id="toc_0.2">关于yum</h2>
<p>
与apt功能类似的rpm包管理系统，那就是yum。
</p>

<p>
yum的宗旨是自动化地升级，安装/移除rpm包，收集rpm包的相关信息，检查依赖性并自动提示用户解决。yum的关键之处是要有可靠的repository，顾名思义，这是软件的仓库，它可以是http或ftp站点， 也可以是本地软件池，但必须包含rpm的header，header包括了rpm包的各种信息，包括描述，功能，提供的文件，依赖性等.正是收集了这些 header并加以分析，才能自动化地完成余下的任务。
</p>

<p>
首 先，yum update，这一步是必须的，yum会从服务器的header目录下载rpm的header，放在本地的缓存中，这可能会花费一定的时间，但比起yum 给我们带来方便，这些时间的花费又算的了什么呢？header下载完毕，yum会判断是否有可更新的软件包，如果有，它会询问你的意见，是否更新，还是说 y吧，把系统始终up to date总是不错的，这时yum开始下载软件包并使用调用rpm安装，这可能要一定时间，取决于要更新软件的数目和网络状况，万一网络断了，也没关系，再 进行一次就可以了。升级完毕，以后每天只要使用yum check-update检查一下有无跟新，如果有，就用yum update进行跟新，时刻保持系统为最新，堵住一切发现的漏洞。
</p>

<h2 id="toc_0.3">添加新的源</h2>
<p>
有一系列的服务器，为每个版本的 Fedora 分别提供了一些仓库。常用的这样的服务器有：
</p>
<ul>
<li>
台灣義守大學的Mirror站
</li>
<li>
上海交通大学的Mirror站
</li>
</ul>
<p>
在自己系统中安装上海交通大学的Mirror站。首先输入打开终端输入su，输入密码，取得管理员权限。在该目录下编辑一个.repo文件/etc/yum.repos.d/sjtu.repo，sjtu.repo 中的内容如下所示：
</p>
<pre>
[Fedora-ftp.sjtu.edu.cn]
name=Fedora 12 - i386
baseurl=http://ftp.sjtu.edu.cn/fedora/linux/releases/12/Fedora/i386/os/
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora
[Everything-ftp.sjtu.edu.cn]
name=Everything 12 - i386
baseurl=http://ftp.sjtu.edu.cn/fedora/linux/releases/12/Everything/i386/os/
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora
[updates-ftp.sjtu.edu.cn]
name=Fedora updates
baseurl=http://ftp.sjtu.edu.cn/fedora/linux/updates/12/i386/
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora
</pre>
<p>
在下次使用yum命令的时候，就会把该源加入到搜索路径下。你也可以使用yum makecache命令将这个源的索引表先下载到本地。
</p>

<p>
安装第三方仓库rpmfusion
</p>
<pre>
rpm -ivh http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm
rpm -ivh http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm
</pre>

<h2 id="toc_0.4">常用yum命令</h2>
<pre>
1.列出所有可更新的软件清单 命令：yum check-update
2.安装所有更新软件 命令：yum update
3.仅安装指定的软件 命令：yum install 软件名
例如：yum install gcc
4.仅更新指定的软件 命令：yum update 软件名
例如：yum update gcc
注：其实，如果系统已经安装了该软件，yum install和yum update达到的效果是一样的，他会检查在仓库里是否有该软件更新的版本。
5.列出所有已经安装的和可安裝的软件清单（Installed Packages   Available Packages） 命令：yum list
6.删除软件 命令：yum remove xxx，同安装一样，yum也会查询数据库，给出解决依赖关系的提示。 
7.使用YUM查找软件包 命令：yum search 
8.列出所有可更新的软件包 命令：yum list updates
9.列出所有已安装的软件包 命令：yum list installed
10.列出所有已安装但不在 Yum Repository 內的软件包 命令：yum list extras
11.列出所指定的软件包 命令：yum list 软件包
12.使用YUM获取软件包信息 命令：yum info 软件包
13.列出所有软件包的信息 命令：yum info
14.列出所有可更新的软件包信息 命令：yum info updates
15.列出所有已安裝的软件包信息 命令：yum info installed
16.列出所有已安裝但不在 Yum Repository 內的软件包信息 命令：yum info extras
17.列出软件包提供哪些文件 命令：yum provides 
</pre>

<h2 id="toc_0.5">yum详解</h2>
<h3 id="toc_0.5.1">yum的header缓存</h3>
<p>
前面说过，在执行yum update命令的时候，这一步就是yum会从服务器的header目录下载rpm的header，放在本地的缓存中。例如，我的就是存放在下面的目录下：
</p>
<pre>
[root@localhost 12]# pwd
/var/cache/yum/i386/12
[root@localhost 12]# ls
dvd_iso                     livna                   rpmfusion-nonfree-updates
Everything-ftp.sjtu.edu.cn  rpmfusion-free          updates
fedora                      rpmfusion-free-updates  updates-ftp.sjtu.edu.cn
Fedora-ftp.sjtu.edu.cn      rpmfusion-nonfree
[root@localhost 12]# du -sh *
25M     dvd_iso
120M    Everything-ftp.sjtu.edu.cn
129M    fedora
25M     Fedora-ftp.sjtu.edu.cn
8.0K    livna
3.0M    rpmfusion-free
3.5M    rpmfusion-free-updates
624K    rpmfusion-nonfree
1.1M    rpmfusion-nonfree-updates
387M    updates
67M     updates-ftp.sjtu.edu.cn
</pre>
<p>
yum就是根据存放在这里的这些rpm的header来检测系统中安装的软件（rpm软件包）是不是最新版本，需不需要update。其实，在每一次使用yum intall xxx命令的使用，yum会自动将/etc/yum.repos.d/目录下.repo文件对应源的header文件下载到本地。
</p>

<p>
如果我们觉得它们占用了磁盘空间，可以使用yum clean指令进行清除，更精确的用法是yum clean headers清除header，yum clean packages清除下载的rpm包，yum clean all一股脑儿全部清除。 
</p>
<pre>
1.清除缓存目录(/var/cache/yum)下的软件包
命令：yum clean packages
2.清除缓存目录(/var/cache/yum)下的 headers
命令：yum clean headers
3.清除缓存目录(/var/cache/yum)下旧的 headers
命令：yum clean oldheaders
4.清除缓存目录(/var/cache/yum)下的软件包及旧的headers
命令：yum clean, yum clean all (= yum clean packages; yum clean oldheaders) 
</pre>
<p>
<strong>注意，在这个cache文件夹下，其实，对应这/etc/yum.repo.d/下面的每一个仓库描述文件（或者叫做源描述文件），如果你修改或者删除了了/etc/yum.repo.d/下面的这些文件，这yum clean 就没办法清除这些文件了。</strong>
</p>

<p>
yum makecache就是把服务器的包header信息下载到本地电脑缓存起来。配合yum -C search xxx使用,不用上网检索就能查找软件信息。
</p>
<pre>
  -C                    run entirely from cache, don't update cache
</pre>

<h3 id="toc_0.5.2">查看和跟新某个软件包</h3>
<p>
查看系统中安装的某个包的版本以及现在可以跟新的最新版本：
</p>
<pre>
yum makecache
yum info xxx 
</pre>
<p>
例如，查看kdegraphics这个包的情况，可以看出，输出结果列举了已经安装的软件包（Installed Packages）和源中的最新软件包（Available Packages）。
</p>
<pre>
[root@localhost 12]# yum info kdegraphics
Loaded plugins: presto, refresh-packagekit
Installed Packages
Name       : kdegraphics
Arch       : i686
Epoch      : 7
Version    : 4.3.2
Release    : 3.fc12
Size       : 6.7 M
Repo       : installed
From repo  : dvd_iso	//说明现在安装的软件包是通过dvd_iso这个iso本地源安装的
Summary    : K Desktop Environment - Graphics Applications
URL        : http://www.kde.org/
License    : GPLv2
Description: Graphics applications, including
	   : * gwenview (an image viewer)
	   : * kamera (digital camera support)
	   : * kcolorchooser (a color chooser)
	   : * kolourpaint4 (an easy-to-use paint program)
	   : * kruler (screen ruler and color measurement tool)
	   : * ksnapshot (screen capture utility)
	   : * okular (a document viewer)

Available Packages
Name       : kdegraphics
Arch       : i686
Epoch      : 7
Version    : 4.4.5	//相对现在安装的4.3.2为更新版本
Release    : 3.fc12
Size       : 3.2 M
Repo       : updates-ftp.sjtu.edu.cn	//说明这个更新版本的软件包是在sjtu这个服务器源上
Summary    : KDE Graphics Applications
URL        : http://www.kde.org/
License    : GPLv2
Description: Graphics applications, including
	   : * gwenview (an image viewer)
	   : * kamera (digital camera support)
	   : * kcolorchooser (a color chooser)
	   : * kolourpaint4 (an easy-to-use paint program)
	   : * kruler (screen ruler and color measurement tool)
	   : * ksnapshot (screen capture utility)
	   : * okular (a document viewer)
</pre>

<h3 id="toc_0.5.3">gpg的问题</h3>
<p>
有时用yum install xxx.rpm时会提示"Package xxx.rpm is not signed"而使安装中断，有两种解决方法：
</p>

<p>
(1)加上--nogpgcheck选项
</p>
<pre>
yum --nogpgcheck install xxx.rpm
</pre>
<p>
(2)修改/etc/yum.conf
</p>
<pre>
vim /etc/yum.conf 将gpgcheck=1改为gpgcheck=0
</pre>

<h2 id="toc_0.6">未解决的问题</h2>
<p>
如何只安装一个package中的某一个软件呢，例如，我只想安装kdegraphics中的okular这个pdf阅读器？
</p>
<pre>
  Details:
  Graphics applications, including
  * gwenview (an image viewer)
  * * kamera (digital camera support)
  * * kcolorchooser (a color chooser)
  * * kolourpaint4 (an easy-to-use paint program)
  * * kruler (screen ruler and color measurement tool)
  * * ksnapshot (screen capture utility)
  * * okular (a document viewer)
</pre>
<div id="footer">
    <p id="legal">Copyright &copy; 2012 &middot;<a href="http://nienet.com">NIENET</a>. All Rights Reserved.</p>
</div>
</div>
</body>
</html>
